<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
  <link href="bootstrap.min.css" rel="stylesheet" type="text/css" media="all">
    <script src="https://code.highcharts.com/highcharts.src.js"></script>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col">
      <img src="sputnik_logo.png" class="img-fluid" />
      </div>
    </div>
    <div class="row charts">
	    <div id="pie_chart"></div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
 var make_series = function(data) {
	 var statuses = data.status_codes;
	 var counts = [];
	 const reducer = (accumulator, currentValue) => accumulator + currentValue;
	 for (code in statuses) {
		 counts.push(statuses[code].length);
	}
         var total = counts.reduce(reducer);
	 var series = [];
	 for (code in statuses) {
		 series.push({
			 name: code,
			 y: (statuses[code].length / total) * 100
		 })
	 }
	 return series;
 }
    var listener = function() {
	    var data = JSON.parse(req.response);
	    var series = make_series(data);
    Highcharts.chart('pie_chart', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Status codes per page'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Status codes',
        colorByPoint: true,
        data: series
    }]
});
}

    var req = new XMLHttpRequest();
    req.addEventListener("load", listener);
    req.overrideMimeType("application/json; charset=utf8");
    req.open("GET", "report.json");
    req.send();

</script>

</body>
